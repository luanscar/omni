generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model Channel {
  id         String      @id @default(uuid())
  name       String
  type       ChannelType
  identifier String?
  token      String?
  active     Boolean     @default(true)
  tenantId   String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  tenant     Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("channels")
}

model Contact {
  id            String   @id @default(uuid())
  name          String
  phoneNumber   String?
  email         String?
  profilePicUrl String?
  customFields  Json?
  tenantId      String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([phoneNumber, tenantId])
  @@map("contacts")
}

model Tenant {
  id        String    @id @default(uuid())
  name      String
  slug      String    @unique
  active    Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  channels  Channel[]
  contacts  Contact[]
  users     User[]

  @@map("tenants")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(AGENT)
  active    Boolean  @default(true)
  avatarUrl String?
  tenantId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("users")
}

enum ChannelType {
  WHATSAPP
  INSTAGRAM
  TELEGRAM
  WEBCHAT
}

enum UserRole {
  ADMIN
  AGENT
  MANAGER
}
