generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model TeamMember {
  id String @id @default(uuid())

  teamId String
  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  role TeamRole @default(MEMBER) // Papel ESPECÍFICO do time

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([teamId, userId]) // Um usuário só pode estar uma vez no mesmo time
  @@map("team_members")
}

model Team {
  id          String  @id @default(uuid())
  name        String
  description String?

  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  members TeamMember[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("teams")
}

model Channel {
  id         String      @id @default(uuid())
  name       String
  type       ChannelType
  identifier String?
  token      String?
  active     Boolean     @default(true)
  tenantId   String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  tenant     Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("channels")
}

model Contact {
  id            String   @id @default(uuid())
  name          String
  phoneNumber   String?
  email         String?
  profilePicUrl String?
  customFields  Json?
  tenantId      String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([phoneNumber, tenantId])
  @@map("contacts")
}

model Tenant {
  id        String    @id @default(uuid())
  name      String
  slug      String    @unique
  active    Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  channels  Channel[]
  contacts  Contact[]
  users     User[]
  teams     Team[]

  @@map("tenants")
}

model User {
  id              String       @id @default(uuid())
  email           String       @unique
  password        String
  name            String
  role            UserRole     @default(AGENT)
  active          Boolean      @default(true)
  avatarUrl       String?
  tenantId        String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  tenant          Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  teamMemberships TeamMember[]

  @@map("users")
}

enum ChannelType {
  WHATSAPP
  INSTAGRAM
  TELEGRAM
  WEBCHAT
}

enum UserRole {
  ADMIN
  AGENT
  MANAGER
}

enum TeamRole {
  ADMIN
  MEMBER
}
